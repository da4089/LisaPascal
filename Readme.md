This is a parser for the Lisa Pascal dialect which I started to implement on January 22, 2023. The reason was that the Computer History Museum published the Apple Lisa source code on January 19, 2023 (see https://computerhistory.org/blog/the-lisa-apples-most-influential-failure/), and I was looking for a tool to study/analyze the code. 

Lisa Pascal was an extension to the Pascal used on the Apple II and III, but not yet object-oriented. I found a [specification of the language here](http://lisa.sunder.net/Pascal_Reference.pdf) which I used to implement the parser. 

To develop and debug the grammar I used my [EbnfStudio tool](https://github.com/rochus-keller/EbnfStudio). I started based on a Pascal grammar corresponding to the 1975 version of Wirth and Jensen's "Pascal User Manual & Report" which I found [here](https://www.icosaedro.it/bnf_chk/ebnf-pascal.txt). I then modified this grammar for EbnfStudio compatibility, fixed left recursion and LL(1) ambiguity, and then correlated the grammar with the mentioned "Pascal Reference Manual for the Lisa", which lead to quite a few additions, removals or other changes. After writing a lexer and generating a parser using Coco/R (based on the grammar file generated by EbnfStudio) I adapted the grammar to the actual syntax used in the Lisa source files.

The Lisa Source code provided by the Computer History Museum contains 1092 plain text source files; further analysis revealed that 614 of which are Pascal and ~203 are MC68000 assembler files; another 126 files are EXEC scripts, and the remaining 144 are emails, documentation, protocols and text resources. About 120 files look like binary encoded sources an other texts which I didn't inspect yet. 

Cloc (http://cloc.sourceforge.net) counts 456 kSLOC, of which 408 kSLOC are Pascal, 45 kSLOC are Assembler and 4 kSLOC are EXEC scripts.

#### Current Status on January 23, 2023

The parser works in principle; 381 of the 614 Lisa Pascal file found in the source tree parse without an error; most of the other 233 Lisa Pascal files have the same parser error, which is caused because the files are either incomplete or there are alternative parts of the code in the same file. It turned out that the Lisa source code heavily depends on a preprocessor, which is controled by source code directives of the form {$directive arguments}. There is e.g a {$I filepath} directive to include other source files, or an {$IFC variable} directive to enable or mute sections of the file (like #ifdef/#endif in C). Without this preprocessor, which I have not implemented (yet), the mentioned syntax errors cannot be avoided. I e.g. had to add a "non_regular_unit" to the grammar to deal with the fact, that some files only include a part of a program or a unit, so the parser could handle these files; but this is only a provisional fix and to continue the project the implementation of the preprocessor is unavoidable.

#### Current Status on January 26, 2023

The source tree is converted to a virtual file system using the original file names, considering Pascal files only. All program and unit files
of this file system are parsed and include directives are resolved. Of the 360 program or unit files (with includes) 199 parse without an error.
The Lisa toolkit uses Clascal which is not yet supported and leads to parsing errors.

#### Current Status on January 28, 2023

Conditional compilation and the Clascal syntax are implemented and tested. The LISA_OS part of the tree (~200 kSLOC) parses with no errors but four missing include files. The full source tree (~400 kSLOC measured with my tools) has 12 missing include files and 7 syntax errors. The 400 kSLOC parse on my machine in less than 7 seconds.

The CodeNavigator shows the virtual file system (i.e. the one assumed by the source files) with all programs and units; the files can be browsed in a syntax highlighted viewer; semantic navigation is pending.


#### Goal

My goal was to implement tools as I did it e.g. for [Oberon](https://github.com/rochus-keller/Oberon/blob/master/README_old.md) or [Smalltalk](https://github.com/rochus-keller/Smalltalk/blob/master/Readme.md) to analyze the code and checking it e.g. for completeness and feasibility to compile and run it on a Lisa emulator (such as https://lisa.sunder.net/).
